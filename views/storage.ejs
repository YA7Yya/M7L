  <!DOCTYPE html>
  <html lang="ar">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Storage Management</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

      <link href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-dark@5.0.16/dark.min.css" rel="stylesheet" />
      <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert2/11.7.32/sweetalert2.min.js" integrity="sha512-3PL7jW3xI1EjF2Hfqwv5u6nKG/BnUbWytnJDhsY/q5CbIB5XzoHNhJvgmFeVD7xgC9DbKDm+gPP9uDAAfLAZUA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
      <!-- Bootstrap CSS -->
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="./CSS/storage.css">
  </head>
  <body>
      <div class="container position-relative">
      
          <a href="/crud">
              <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-house-door-fill" viewBox="0 0 16 16">
                  <path d="M6.5 14.5v-3.505c0-.245.25-.495.5-.495h2c.25 0 .5.25.5.5v3.5a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5"/>
                </svg>
          </a>
            <header class="text-center">
              <h1>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²Ù†</h1>
          </header>
          <a href="/logs" class="position-absolute top-0 start-0 m-4">
              <i class="fa fa-history fa-2x" aria-hidden="true"></i>
            </a>
          <section class="add-item">
  <center>
  
      <h2 class="addForStorage">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ù„Ù„Ù…Ø®Ø²Ù†</h2>
  </center>
  <form id="updateForm" action="" method="post" class="p-4 border rounded" style="display: none; background-color: #f8f9fa;">
      <a href="/logs" class="position-absolute top-0 start-0 m-4">
          <i class="fa fa-history fa-2x" aria-hidden="true"></i>
        </a>
      <h2 class="text-center mb-4">ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†ØªØ¬ Ù„Ù„Ù…Ø®Ø²Ù†</h2>
      <div class="mb-3">
        <label for="puname" class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
        <input type="text" id="puname" name="productName" class="form-control" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬" required>
      </div>
      <div class="mb-3">
        <label for="puquantity" class="form-label">Ø§Ù„ÙƒÙ…ÙŠØ©</label>
        <input type="number" name="quantity" id="puquantity" class="form-control" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©" required>
      </div>
      <div class="mb-3">
        <label for="puprice" class="form-label">Ø³Ø¹Ø± Ø§Ù„Ø¬Ù…Ù„Ø© Ù„Ù„ÙˆØ­Ø¯Ø©</label>
        <input type="number" name="wholePrice" class="form-control" id="puprice" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø¬Ù…Ù„Ø© Ù„Ù„ÙˆØ­Ø¯Ø©" required>
      </div>
      <div class="mb-3">
        <label for="puunit" class="form-label">Ø§Ù„ÙˆØ­Ø¯Ø©</label>
        <select name="unit" class="form-select" required id="puunit">
          <option value="Ø§Ù„ÙˆØ­Ø¯Ø©" disabled selected>Ø§Ù„ÙˆØ­Ø¯Ø©</option>
          <option value="Ø¯Ø³ØªØ©">Ø¯Ø³ØªØ©</option>
          <option value="1/2 Ø¯Ø³ØªØ©">1/2 Ø¯Ø³ØªØ©</option>
          <option value="Ù‚Ø·Ø¹Ø©">Ù‚Ø·Ø¹Ø©</option>
          <option value="ÙƒØ±ØªÙˆÙ†Ø©">ÙƒØ±ØªÙˆÙ†Ø©</option>
          <option value="Ø·Ù‚Ù…">Ø·Ù‚Ù…</option>
        </select>
      </div>
      <div class="mb-3">
        <label for="pustatus" class="form-label">Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù†ØªØ¬</label>
        <select name="status" class="form-select" id="pustatus" required>
          <option value="Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù†ØªØ¬" disabled selected>Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù†ØªØ¬</option>
          <option value="Ù…ØªÙˆÙØ± ğŸŸ¢">Ù…ØªÙˆÙØ± ğŸŸ¢</option>
          <option value="ØºÙŠØ± Ù…ØªÙˆÙØ± ğŸ”´">ØºÙŠØ± Ù…ØªÙˆÙØ± ğŸ”´</option>
        </select>
      </div>
      <button type="submit" class="btn btn-success w-100">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬</button>
    </form>
    


              <form id="addItemForm" class="addingForm" action="/storage" method="post">
          
                  <input type="text" id="itemName" name="productName" class="form-control" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬" required>
                  <input type="number" name="quantity" id="itemQuantity" class="form-control" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©" required>
                  <input type="number" name="wholePrice" class="form-control" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø¬Ù…Ù„Ø© Ù„Ù„ÙˆØ­Ø¯Ø©" required>
                  <select name="unit" class="form-select" required>
                      <option value="Ø§Ù„ÙˆØ­Ø¯Ø©" disabled selected>Ø§Ù„ÙˆØ­Ø¯Ø©</option>
                      <option value="Ø¯Ø³ØªØ©">Ø¯Ø³ØªØ©</option>
                      <option value="1/2 Ø¯Ø³ØªØ©">1/2 Ø¯Ø³ØªØ©</option>
                      <option value="Ù‚Ø·Ø¹Ø©">Ù‚Ø·Ø¹Ø©</option>
                      <option value="ÙƒØ±ØªÙˆÙ†Ø©">ÙƒØ±ØªÙˆÙ†Ø©</option>
                      <option value="Ø·Ù‚Ù…">Ø·Ù‚Ù…</option>
                  </select>
                  <select name="status" class="form-select" required>
                      <option value="Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØªØ¬" disabled selected >Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù†ØªØ¬</option>
                    <option class="available" value="Ù…ØªÙˆÙØ± ğŸŸ¢">Ù…ØªÙˆÙØ± ğŸŸ¢</option>
                    <option class="notAvailable" value="ØºÙŠØ± Ù…ØªÙˆÙØ± ğŸ”´">ØºÙŠØ± Ù…ØªÙˆÙØ± ğŸ”´</option>
                  </select>
                  <button type="submit" class="btn btn-primary w-100" id="submitButton">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬</button>
              
              </form>
              <br>
              <input type="text" id="searchInput" class="form-control" placeholder="Search for products...">
              <script>
                  $(document).ready(function() {
                    $('#searchInput').on('keyup', function() {
                      var value = $(this).val().toLowerCase();
                      $('#tableBody tr').filter(function() {
                        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                      });
                    });
                  });
                  </script>
          </section>
          <section class="storage-list mt-5">
              <h2 class="text-center">Ø§Ù„Ù…Ø®Ø²Ù†</h2>
              <table class="table table-striped table-bordered mt-3 table-responsive table table-hover bg-light">
                  <thead>
                      <tr class="productsdata">
                          <th>Ø§Ù„ØµÙ†Ù</th>
                          <th>Ø§Ù„ÙƒÙ…ÙŠØ©/Ø§Ù„ÙˆØ­Ø¯Ø©</th>
                          <th>Ø³Ø¹Ø± Ø§Ù„Ø¬Ù…Ù„Ø© Ù„Ù„ÙˆØ­Ø¯Ø©</th>
                          <th>Ø­Ø§Ù„Ø© Ø§Ù„ØµÙ†Ù</th>
                          <th>Ø§Ø®Ø± ØªØ­Ø¯ÙŠØ«</th>
                          <th>Ù†Ø´Ø§Ø·</th>
                      </tr>
                  </thead>
                  <tbody id="tableBody">
                      <% product.forEach(product =>{ %> 
                          <tr style="padding-bottom: 10px;">
                          <td><%= product.productName %> </td>
                          <td><%= product.quantity%> / <%= product.unit %>  </td>
                          <td style="text-align: center;font-weight: bold;"><%= product.wholePrice %> </td>
                          <td><%= product.status %> </td>
                          <td><%= moment(product.updatedAt).format('LL') %> </td>
                          <td>
                              <button class="btn btn-outline-danger delete" data-productId="<%= product._id %>">
                                  <i class="fa fa-trash"></i>
                                </button>
                              <button class="btn btn-outline-warning update" data-productId="<%= product._id %>">
                                  <i class="fa fa-edit" ></i>
                                </button>
                          </td>
                      </tr>
                          <% }) %> 
                
                  </tbody>
              </table>
          </section>
      </div>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.30.1/locale/ar.min.js"></script>
      <script src="../js/Storage.js" defer></script>

      <script>
          $(document).ready(function() {
        let offset = 3;
        let isLoading = false; // Flag to track loading state
      
        $(window).on('scroll', function() {
          if ($(window).scrollTop() + $(window).height() >= $(document).height() - 100) {
            if (!isLoading) {
              loadMoreProducts();
            }
          }
        });
      
        function loadMoreProducts() {
          isLoading = true; // Set loading state to true to prevent more requests
      
          $.ajax({
            url: "/loadMoreStorageProducts",
            method: "GET",
            data: { offset: offset },
            success: function(data) {
              if (data.length > 0) {
                data.forEach(function(product) {
                  let price = product.wholePrice * 1.50;
                  let productRow = `
                    <tr class="productsdata">
                      <td>${product.productName}</td>
                      <td>${product.quantity} / ${product.unit}</td>
                      <td style="text-align: center;font-weight: bold;">${product.wholePrice}</td>
                      <td>${product.status}</td>
                      <td>${moment(product.updatedAt).format('LL')}</td>
                      <td>
                              <button class="btn btn-outline-danger delete" data-productId="${product._id}">
                                  <i class="fa fa-trash"></i>
                                </button>
                                  <button class="btn btn-outline-warning update" data-productId="${product._id}">
                                  <i class="fa fa-edit" ></i>
                                </button>
                          </td>
                    </tr>
                  `;
                  $('#tableBody').append(productRow);
                });
                offset += 3; // Increase the offset for the next batch
                isLoading = false; // Reset loading state after content is loaded
              } else {
                // No more products to load, you can remove the scroll event listener or handle it differently
                $(window).off('scroll');
              }
            },
            error: function(err) {
              console.error("Error loading more products:", err);
              isLoading = false; // Reset loading state even on error
            }
          });
        }
      });
      let quantity = document.querySelector("#itemQuantity");
  let available = document.querySelector(".available");
  let notAvailable = document.querySelector(".notAvailable");
  document.addEventListener('DOMContentLoaded', () => {
    if (isNaN(quantity)) {
      $(notAvailable).attr("selected", true);  // Set 'ØºÙŠØ± Ù…ØªÙˆÙØ±' as selected
    }
  quantity.addEventListener('input', (event) => {  // Use 'input' event

    let changedValue = Number(event.target.value); // Convert the input value to a number
    if (changedValue === 0) {
      $(notAvailable).attr("selected", true);  // Set 'ØºÙŠØ± Ù…ØªÙˆÙØ±' as selected
    } else {
      $(available).attr("selected", true);  // Set 'Ù…ØªÙˆÙØ±' as selected if the value is not 0
    }
  });
  });



  document.getElementById('addItemForm').addEventListener('submit', function() {
          // Disable the submit button after form submission
          document.getElementById('submitButton').disabled = true;
      });

        </script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
  </html>
